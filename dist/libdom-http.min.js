!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require(void 0),require(void 0)):"function"==typeof define&&define.amd?define("libdom-http",[,],t):"object"==typeof exports?exports["libdom-http"]=t(require(void 0),require(void 0)):e["libdom-http"]=t(e[void 0],e[void 0])}(this,function(e,t){return function(e){function t(n){if(r[n])return r[n].exports;var o=r[n]={exports:{},id:n,loaded:!1};return e[n].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var r={};return t.m=e,t.c=r,t.p="/assets/",t(0)}([function(e,t,r){e.exports=r(1)},function(e,t,r){(function(t){"use strict";var n=r(2),o=r(3),s=r(5),i=r(6),a=r(13),u=n.rehash,l=s.register,c=i.register,d=a.request;if(!t.libdom)throw new Error("libdom package is not found! unable to load http module");t.libdom.http=d,o.xhr&&(l("xhr",r(16)),l("xhr2",r(18))),c("text/plain",!0,r(19)),o.formdata&&c("multipart/form-data",!1,r(20)),n.env.browser&&l("form-upload",r(o.xhr&&o.file&&o.blob?18:21)),u(d,a,{request:"request",defaults:"defaults"}),u(d,s,{driver:"register",use:"use"}),u(d,r(15),{parseHeader:"parse",eachHeader:"each"}),u(d,i,{transformer:"register",transform:"transform"}),i.chain=s.chain=d,e.exports=d.default=d}).call(t,function(){return this}())},function(t,r){t.exports=e},function(e,t,r){(function(t){"use strict";var n=r(4),o=n.env,s=t,i=s.XMLHttpRequest,a=!!i,u=!1,l=!1,c=!1,d=!1,p=!1,f=!!s.XDomainRequest;o.browser?i&&(i=i.prototype,u="withCredentials"in i,l="overrideMimeType"in i,c="timeout"in i,d="sendAsBinary"in i,p="onprogress"in i):o.node,e.exports={xhr:a,xhrx:u,xhrmime:l,xhrtime:c,xhrbin:d,xhrbytes:p,xdr:f,formdata:!!s.FormData,file:!!s.File,blob:!!s.Blob},s=i=null}).call(t,function(){return this}())},function(e,r){e.exports=t},function(e,t,r){"use strict";function n(e,t){var r=a;return r.string(e)&&r.method(t)&&(u.set(e,t),t.prototype.type=e,l||(l=e)),c.chain}function o(e){return u.exists(e)}function s(e){return arguments.length>0&&o(e)&&(l=e),l}function i(e){return u.get(e)}var a=r(2),u=a.createRegistry(),l=null,c={register:n,exists:o,use:s,get:i};e.exports=c.chain=c},function(e,t,r){"use strict";function n(e,t,r){var n,o,s,p=i,f=u,h=c;return p.method(r)&&(e=a.parse(e),e&&(s="all"===t,t=t===!0?l:h,n=t+e.root,o=t+e.string,o===n||f.exists(n)||f.set(n,r),f.set(o,r),s&&f.set(h+e.string,r))),d.chain}function o(e,t,r){var n,o=u;if(e=a.parse(e)){if(t=t===!0?l:c,n=t+e.string,o.exists(n))return o.get(n)(r);if(n=t+e.root,o.exists(n))return r=o.get(n)(r),i.array(r)?r:[null,null]}return[null,r]}var s,i=r(2),a=r(7),u=i.createRegistry(),l="request-",c="response-",d={register:n,transform:o};e.exports=d.chain=d,s=r(8),n("application/json",!1,s).register("text/x-json",!1,s),s=r(10),n("application/json",!0,s).register("text/x-json",!0,s),n("application/x-www-form-urlencoded",!1,r(11)).register("multipart/form-data",!1,r(12))},function(e,t,r){"use strict";function n(e){var t,r,n,u,l,c,d,p=s,f=i,h=a,m=o,g="; ",y=null;if(m.string(e)&&p.test(e)){if(t=e.match(p),e=t[1].toLowerCase(),r=t[2].toLowerCase(),n=t[3]||""){for(y={},n=n.split(";"),c=n.length;c--;)t=n[c].match(f),t&&(u=t[1].toLowerCase(),l=t[2],n[c]=u+"="+l,y[u]=h.test(l)?l.substring(1,l.length-1):l);n=n.join(g)}return d=e+"/"+r,{string:d+(n?g+n:""),root:d,type:e,subtype:r,params:y}}}var o=r(2),s=/^([a-z0-9\-\_]+)\/([a-z\-\_0-9]+)(([ \s\t]*\;([^\;]+))*)$/,i=/^[ \t\s]*([a-z0-9\-\_]+)\=(\"([^\"]+)\"|[a-z0-9\-\_]+)[ \t\s]*$/,a=/^\"[^\"]+\"/,u={parse:n};e.exports=u},function(e,t,r){"use strict";function n(e,t,r,n,o){var a=s,u=e.returnValue,l="field"===n;if(l){if("file"===o)return;r=r.value}"number"===r?r=isFinite(r)?r.toString(10):"":a.string(r)||(r=i.jsonify(r)),l||"field-options"===n?a.urlFill(u,t,r):u[t]=r,u=r=null}function o(e){var t=i,r={index:{},returnValue:{}},o=t.each(e,n,r);return[null,t.jsonify(o)]}var s=r(2),i=r(9);e.exports=o},function(e,t,r){(function(t){"use strict";function n(e){return u.is(e,1)&&"FORM"===e.tagName.toUpperCase()}function o(e){if(u.is(e,1))switch(e.tagName.toUpperCase()){case"INPUT":case"TEXTAREA":case"BUTTON":case"SELECT":case"OUTPUT":return!0}return!1}function s(e,t,r){var s,a,u,p=l,f=c,h=d,m=null,g=i,y=p.object,v=p.contains,b=y(e);if(n(e)?(e=e.elements,m=h,b=!1):o(e)?(m=h,e=[e]):b?m=f:p.array(e)&&(m=h,b=!1),y(r)||(r={}),v(r,"returnValue")||(r.returnValue=null),b||m===h)if(b)for(u in e)v(e,u)&&g(e[u],u,t,r);else for(s=-1,a=e.length;a--;)g(e[++s],null,t,r);return r.returnValue}function i(e,t,r,n){var s,i,a,u,c,d=l,p=d.string,f=p(t),h="variant";if(o(e)){if(!f&&!p(t=e.name))return;switch(s="field",f=!0,h=e.type,e.tagName.toUpperCase()){case"BUTTON":p(h)||(h="button");break;case"SELECT":for(s="field-options",h="select",u=e.options,i=-1,a=u.length;a--;)c=u[++i],c.selected&&r(n,t,c.value,s,h);return void(u=c=null);case"TEXTAREA":h="text"}switch(h){case"checkbox":case"radio":if(!e.checked)return}}else switch(!0){case d.array(e):s="array";break;case d.date(e):s="date";break;default:s=typeof e}f&&r(n,t,e,s,h)}function a(e){var r=t.JSON,n=null;if(!r)throw new Error("JSON is not supported in this platform");try{n=r.stringify(e)}catch(e){}return"null"===n||null===n?"":n}var u=r(4),l=r(2),c=1,d=2;e.exports={each:s,form:n,field:o,jsonify:a}}).call(t,function(){return this}())},function(e,t,r){(function(t){"use strict";function n(e){if(!s)throw new Error("JSON is not supported in this platform");if(!o.string(e))return null;try{e=s.parse(e)}catch(e){return null}return[null,e]}var o=r(2),s=t.JSON;s||(s=!1),e.exports=n}).call(t,function(){return this}())},function(e,t,r){"use strict";function n(e,t,r,n,o){var i=e.returnValue;if("field"===n){if("file"===o)return;r=r.value}"number"==typeof r?r=isFinite(r)?r.toString(10):"":"string"!=typeof r&&(r=s.jsonify(r)),i[i.length]=t+"="+encodeURIComponent(r)}function o(e){var t=s.each(e,n,{returnValue:[]});return[null,t.join("&")]}var s=r(9);e.exports=o},function(e,t,r){"use strict";function n(){for(var e=Math.random().toString().substr(2),t=[],r=0,n=u-e.length;n--;)t[r++]="-";return t[r++]=e,t.join("")}function o(e,t,r,n,o){var s=a,u=e.returnValue;if("field"===n){if("file"===o)return;r=r.value}"number"==typeof r?r=isFinite(r)?r.toString(10):"":"string"!=typeof r&&(r=i.jsonify(r)),u[u.length]=['Content-Disposition: form-data; name="'+t+'"',"Content-type: application/octet-stream",s,r].join(s)}function s(e){var t=a,r=n(),s=i.each(e,o,{returnValue:[]});return s.length||s.splice(0,0,r),[["Content-Type: multipart/form-data; charset=utf-8;","    boundary="+r].join(t),r+t+s.join(t+r+t)+r+"--"+t]}var i=r(9),a="\r\n",u=48;e.exports=s},function(e,t,r){"use strict";function n(e){return l.string(e)&&(e=e.toLowerCase(),h.indexOf(e)!==-1)?e:f.get("method")}function o(e){var t=e.driver,r=c;return l.run("libdom-http.driver.resolve",[e,t]),t=e.driver,r.exists(t)?t:r.use()}function s(e,t){var r,o=l,s=o.string;r=e.getAttribute("enctype")||e.getAttribute("encoding"),s(r)&&t.addHeaders("Content-type: "+r),r=e.action,s(r)&&(t.url=r),r=e.method,s(r)&&(t.method=n(r)),r=e.getAttribute("data-driver"),s(r)&&(t.driver=r),r=e.getAttribute("data-response-type"),s(r)&&(t.responseType=r),t.data=e}function i(e,t){var r,o=l,i=o.string,a=p,u=void 0;r=e.form||e.data||e.params||e.body,a.form(r)?s(r,t):null===r&&r===u||(t.data=r),r=e.query||e.urlData||e.urlParams,(a.form(r)||null!==r&&r!==u)&&(t.query=r),r=e.url,i(r)&&(t.url=r),r=e.method,i(r)&&(t.method=n(r)),r=e.driver,i(r)&&(t.driver=r),r=e.responseType,i(r)&&(t.responseType=r),t.addHeaders("headers"in e&&e.headers),t.config=e,r=null}function a(e,t){var r,n,a=l,u=p,h=a.string,g=a.object,y=i,v=new d,b=Promise;return y(f.clone(),v),h(e)?(g(t)?y(t,v):u.form(t)&&s(t,v),v.url=e):g(e)?y(e,v):u.form(e)&&s(e,v),m.indexOf(v.method)===-1&&(v.allowedPayload=!1),h(v.url)&&(r=o(v))?(r=new(c.get(r))(v),v.driver=r,n=b.resolve(v).then(r.setup).then(r.transport).then(r.success).catch(r.error),v.api=n,v=r=null,n):b.reject("Invalid HTTP request configuration.")}function u(e,t){var r=f;return arguments.length>1?(r.set(e,t),g.chain):r.get(e)}var l=r(2),c=r(5),d=r(14),p=r(9),f=l.createRegistry(),h=["get","post","put","patch","delete","options"],m=["post","put","patch"],g={request:a,defaults:u};e.exports=g,c.use("xhr"),f.set("method","get"),f.set("headers",{accept:"application/json,text/x-json,text/plain,*/*;q=0.8","content-type":"application/json"})},function(e,t,r){"use strict";function n(e,t){var r,n=e.match(b);return n&&c.string(t)?(r=n[2],n[2]=(r?r+"&":"?")+t,n[3]=n[3]||"",n.slice(1).join("")):e}function o(e){var t,r,n,o,s,i=v,a=y;if(!h){for(h=!0,n=(new Date).getTime(),o=g,e=e===!0,t=i.length;t--;)r=i[t],e?r.destroy():r.destroyed||(s=r.createdAt,!s||r.processing?r.createdAt=n:s+o<n&&r.destroy()),r.destroyed&&i.splice(t,1);!i.length&&a&&(clearInterval(a),y=!1),h=!1}}function s(e){var t=y;e===!0?(t&&(clearInterval(t),y=!1),o(e)):t||(y=setInterval(o,m))}function i(){s(!0)}function a(){l.apply(this,arguments)}function u(){l.apply(this,arguments)}function l(){var e=v,t=this;t.destroyed=!1,e[e.length]=t,s()}var c=r(2),d=r(4),p=r(15),f=r(6),h=!1,m=1e3,g=1e4,y=!1,v=[],b=/^([^\?\#]+)(\?[^\?\#]*)?(\#.*)?$/;l.prototype={createdAt:void 0,contentType:"application/octet-stream",headers:null,body:null,data:null,destroyed:!0,processing:!1,constructor:l,begin:function(){var e=this;return e.destroyed||e.processing||(e.processing=!0,delete e.createdAt,s()),e},end:function(){var e=this;return!e.destroyed&&e.processing&&(delete e.processing,delete e.createdAt,s()),e},addHeaders:function(e){var t,r,n=this,o=c;return e=p.parse(e),e&&(t=n.headers,o.object(t)?o.assign(t,e):n.headers=e,r=n.header("content-type"),r?n.contentType=r:delete n.contenType),this},header:function(e){var t=this,r=t.headers,n=c;return n.string(e)&&n.object(r)&&(e=p.headerName(e),n.contains(r,e))?r[e]:null},destroy:function(){var e=this;return e.destroyed||(e.destroyed=!0,c.clear(e)),e}},a.prototype=c.instantiate(l,{url:null,method:"get",constructor:a,response:null,aborted:!1,timeout:0,config:null,queryTransformer:"application/x-www-form-urlencoded",queryAllowed:!0,allowedPayload:!0,getUrl:function(){var e=this,t=c.string,r=f.transform,o=e.url,s=e.query,i=e.data,a=e.queryTransformer,u=n;return e.queryAllowed&&t(o)&&t(a)&&(s=r(a,!1,s)[1],t(s)&&(o=u(o,s)),e.allowedPayload===!1&&(i=r(a,!1,i)[1],t(i)&&(o=u(o,i)))),o},settings:function(e){var t=this.config,r=c;if(r.object(t)&&r.contains(t,e))return t[e]},process:function(){var e=this,t=f.transform(e.header("content-type"),!1,e.data),r=t[0],n=e.responseType,o=e.response;r&&e.addHeaders(r),e.allowedPayload===!1?delete e.body:e.body=t[1],o&&o.destroy(),e.response=o=new u,c.string(n)&&o.addHeaders("Content-type: "+n),o.request=e,o.begin(),t=null}}),u.prototype=c.instantiate(l,{constructor:u,status:0,statusText:"Uninitialized",process:function(){var e=this,t=f.transform(e.header("content-type"),!0,e.body),r=t[0];r&&e.addHeaders(r),e.data=t[1]}}),d.destructor(i),e.exports=a},function(e,t,r){"use strict";function n(e){return e?e.charAt(0).toUpperCase()+e.substring(1,e.length).toLowerCase():""}function o(e,t,r){var o,s,i,a,u,y=e.split(c),v=d,b=p,x=f,T=h,w=m,j=g,C=":",q="$1",S=l.contains,P=n,R=y.length,A=-1,F={},H=[],U=0,N=null;for("undefined"==typeof r&&(r=null);R--;)if(o=y[++A],!A&&x.test(o)||T.test(o))H[U++]="",F[""]=o;else if(v.test(o)){if(s=o.indexOf(C),N=o.substring(0,s),i=o.substring(s+1,o.length).replace(w,q),!i)continue;N=P(N),u=S(F,N),u||(H[U++]=N),j.test(N)?(u||(F[N]=[]),a=F[N],a[a.length]=i):F[N]=i}else N&&b.test(o)&&(i=o.replace(w,q),j.test(N)?(a=F[N],a[a.length-1]+=" "+i):F[N]+=" "+i);for(A=-1,R=H.length;R--;)N=H[++A],t.call(r,N,F[N])}function s(e,t,r,s){var i,a,c,d=l,p=d.string,f=d.number,h=d.array,m=d.contains,y=u,v=g,b=n;if(d.array(e)&&(e=y(e.slice(0)).join("\r\n")),p(e))o(e,t,r,s);else{if(!d.object(e))return!1;"undefined"==typeof r&&(r=null);for(i in e)m(e,i)&&(a=e[i],i=b(i),p(a)||f(a)?t.call(r,i,v.test(i)?[a]:a):h(a)&&(a=y(a.slice(0)),v.test(i)||(c=a.length,a=c?a[c-1]:""),a.length&&t.call(r,i,a)))}return!0}function i(e){var t={};return s(e,a,t)&&t}function a(e,t){this[e]=t}function u(e){for(var t,r=l,n=r.string,o=r.number,s=e.length;s--;)t=e[s],o(t)?e[s]=t.toString(10):n(t)||e.splice(s,1);return e}var l=r(2),c=/\r\n|\r|\n/,d=/^([^ \r\n\t\s\:]+)\:(.+)$/,p=/^([ \r\n\t\s]+.+|[^\:]+)$/,f=/^([a-z]+)[ \t\s]+(\/[^\:]+)[ \t\s]+(HTTP\/[0-9]+\.[0-9]+)$/i,h=/^(HTTP\/[0-9]+.[0-9]+)[ \t\s]+([0-9]+)[ \t\s]+([a-z0-9\-\_]+)$/i,m=/^[ \t\s]*(.+)[ \t\s]*$/,g=/Set\-cookie/i,y={each:s,parse:i,headerName:n};e.exports=y},function(e,t,r){(function(t){"use strict";function n(e,t){var r,n,o=this;for(s.array(e)||(e=[e]),r=-1,n=e.length;n--;)o.setRequestHeader(t,e[++r])}function o(){var e=this,t=[e];i.apply(e,arguments),a.run("after:instantiated",t),t=t[0]=null}var s=r(2),i=r(17),a=s.middleware("libdom-http.driver.xhr"),u=0,l=1,c=2,d=3,p=4,f=i.prototype;o.prototype=s.instantiate(i,{level:1,bindMethods:f.bindMethods.concat(["onReadyStateChange"]),constructor:o,onReadyStateChange:function(){var e,t=this,r=t.request,n=r.xhrTransport,o=a.run,s=[t,r],i=r.resolve,f=r.reject;if(!r.aborted&&i&&f){switch(o("before:readystatechange",s),n.readyState){case u:case l:case c:case d:break;case p:e=n.status,e<200||e>299?f(e):i(e)}o("after:statechange",s)}t=n=r=s=s[0]=s[1]=null},createTransportPromise:function(e){function t(t,r){var n=e;n.resolve=t,n.reject=r,n=null}return new Promise(t)},onSetup:function(e){var r=this,n=[r,e],o=a.run,s=new t.XMLHttpRequest;e.xhrTransport=s,o("before:setup",n),s.onreadystatechange=r.onReadyStateChange,s.open(e.method.toUpperCase(),e.getUrl(),!0),o("after:setup",n),s=n=n[0]=n[1]=null},onTransport:function(e){var t=this,r=s,o=e.xhrTransport,i=e.headers,u=[t,e];a.run("before:request",u),e.transportPromise=t.createTransportPromise(e),i=e.headers,r.object(i)&&r.each(i,n,o),o.send(e.body),a.run("after:request",u),o=u=u[0]=u[1]=null},onSuccess:function(e){var t=this,r=e.xhrTransport,n=e.response,o=[t,e],s=a.run;n.status=r.status,n.statusText=r.statusText,n.addHeaders(r.getAllResponseHeaders()),n.body=r.responseText,s("after:response",o),r=o=o[0]=o[1]=null},onCleanup:function(e){var t,r=this,n=e.xhrTransport;n&&(t=[r,e],a.run("after:cleanup",t),t=t[0]=t[1]=n=n.onreadystatechange=null),e.transportPromise=e.resolve=e.reject=e.xhrTransport=n=null}}),e.exports=o}).call(t,function(){return this}())},function(e,t,r){"use strict";function n(e,t){function r(){return t.apply(e,arguments)}return r}function o(){for(var e,t=this,r=this.bindMethods,o=r.length,s=n;o--;)e=r[o],t[e]=s(t,t[e])}var s=r(2);o.prototype={bindMethods:["setup","transport","process","success","error"],aborted:!1,request:null,response:null,constructor:o,onSetup:function(e){},onTransport:function(e){},onCleanup:function(e){},onSuccess:function(e,t){},onError:function(e){},setup:function(e){var t=this;return t.request=e,t.onSetup(e),e.process(),t.response=e.response,e},transport:function(e){var t;return this.onTransport(e),t=e.transportPromise,t&&s.method(t.then)?(e.begin(),t):Promise.reject(610)},success:function(e){var t=this,r=t.request,n=r&&r.response;return 0===e||e<200&&e>299||!r||!n?t.error(e):(t.onSuccess(r,e),n.process(),r.end(),n.end(),r.transportPromise=null,t.onCleanup(r,n),delete t.request,n)},error:function(e){var t=this,r=t.request,n=r&&r.response;return t.onError(e),r&&(r.transportPromise=null,t.onCleanup(r),r.end()),n&&n.end(),delete t.request,Promise.reject(e)},abort:function(){}},e.exports=o},function(e,t,r){(function(t){"use strict";function n(e,t){var r=t.settings("timeout");l.number(r)&&r>10&&(t.xhrTransport.timeout=r)}function o(e,t){t.settings("withCredentials")===!0&&(t.xhrTransport.withCredentials=!0)}function s(e){var t,r=this,n=r.request,o=n.api;n&&e.lengthComputable&&(t=e.loaded/e.total,n.percentLoaded=t,o&&(o.percentLoaded=t))}function i(e,t){var r=t.api;r.percentLoaded=0,t&&(t.percentLoaded=0),c.on(t.xhrTransport,"progress",e.onProgress)}function a(e,t){b&&c.un(t.xhrTransport,"progress",e.onProgress)}function u(e,r){r.body instanceof t.FormData&&delete r.headers["Content-type"]}var l=r(2),c=r(4),d=r(3),p=l.middleware("libdom-http.driver.xhr"),f=p.register,h="before:request",m=r(16),g=m.prototype,y=g.bindMethods,v=y.length,b=d.xhrbytes,x=0;d.xhrx&&(x++,f(h,o)),d.formdata&&(x++,f(h,u)),b&&(x++,y[v++]="onProgress",g.onProgress=s,f(h,i)),d.xhrtime&&f(h,n),x&&(x>2&&(g.level=2),f("cleanup",a)),e.exports=m}).call(t,function(){return this}())},function(e,t,r){"use strict";function n(e){var t=o;return t.number(e)&&(e=e.toString(10)),["Content-type: text/plain",t.string(e)?e:""]}var o=r(2);e.exports=n},function(e,t,r){(function(t){"use strict";function n(e,t,r,n,o){var a,u,l,c,d=e.returnValue,p=s.string;if("field"===n){if("file"===o){for(a=r.files,u=-1,l=a.length;l--;)r=a[++u],c=r.name,p(c)?d.append(t,r,c):d.append(t,r);return void(d=null)}r=r.value}"number"==typeof r?r=isFinite(r)?r.toString(10):"":"string"!=typeof r&&(r=i.jsonify(r)),d.append(t,r),d=null}function o(e){return[null,i.each(e,n,{returnValue:new t.FormData})]}var s=r(2),i=r(9);e.exports=o}).call(t,function(){return this}())},function(e,t,r){(function(t){"use strict";function n(e,r,n,s){var i,a=t.document,u="libdom-http-oldschool-form"+ ++m,l=a.createElement("div");return l.style.cssText=["visibility: hidden","position: fixed","top: -10px","left: -10px","overflow: hidden","height: 1px","width: 1px"].join(";"),l.innerHTML=['<form id="',u,'"',' method="',e.toUpperCase(),'"',' action="',encodeURI(r),'"',' target="',u,'-result"',' enctype="',n,'"',' encoding="',n,'"',' data-readystate="uninitialized">','<iframe name="',u,'-result"',' id="',u,'-result">',' src="'+s+'">',"</iframe>","</form>"].join(""),i=l.firstChild.firstChild,c.on(i,"load",o),a.body.appendChild(l),a=l=i=null,u}function o(e){var t=c,r=e.target,n=r.parentNode;t.un(r,"load",o),n.setAttribute("data-readystate","ready"),t.dispatch(n,"libdom-http-ready",{}),t=r=n=null}function s(e){return t.document.getElementById(e)}function i(e,t,r,n,o){var s,i=l,a=e.impostors,u=e.fragment,p="field"===n,f=p&&"file"===o,h=null;f&&r.value?(s=r.parentNode,s&&(h=r.cloneNode(),h.disabled=!0,h.readOnly=!0,a[a.length]=[r,h],c.replace(r,h)),h=r,e.files=!0):f||(p&&(r=r.value),"number"===r?r=isFinite(r)?r.toString(10):"":i.string(r)||(r=d.jsonify(r)),h=u.ownerDocument.createElement("input"),h.type="hidden",h.name=t,h.value=r),h&&u.appendChild(h),u=s=h=null}function a(e){var t,r,n,o,s;for(t=e.length;t--;)r=e[t],n=r[0],o=r[1],s=o.parentNode,s&&s.replaceChild(n,o),s=r=r[0]=r[1]=n=o=null}function u(){var e=this;p.apply(e,arguments)}var l=r(2),c=r(4),d=r(9),p=r(17),f=p.prototype,h=/(^<pre>|<\/pre>$)/gi,m=0;u.prototype=l.instantiate(p,{constructor:u,blankDocument:"about:blank",defaultType:"application/json",bindMethods:f.bindMethods.concat(["onFormReady","onFormDeferredSubmit","onRespond"]),createTransportPromise:function(e){function t(t,r){var n=e;n.resolve=t,n.reject=r}return new Promise(t)},onFormReady:function(){var e=this,r=c,n=e.request,o=n.form;r.un(o,"libdom-http-ready",e.onFormReady),o.enctype=o.encoding=n.contentType,n.deferredSubmit=t.setTimeout(e.onFormDeferredSubmit,10),o=null},onFormDeferredSubmit:function(){var e=this,t=e.request,r=t&&t.form;r?(c.on(t.iframe,"load",e.onRespond),r.submit()):t&&t.reject(408),t=r=null},onRespond:function(){var e=this,t=e.request,r=t.iframe,n=!1,o="";c.un(r,"load",e.onRespond);try{o=r.contentWindow.document.body.innerHTML,n=!0}catch(e){}n?(t.formResponse=o.replace(h,""),t.resolve(200)):t.reject(406),r=null},onSetup:function(e){var r=this,o=l,a=[],u=n(e.method,e.getUrl(),e.contentType,r.blankDocument),c=s(u),p={impostors:a,fragment:t.document.createDocumentFragment(),files:!1,driver:r,request:e},f=e.responseType;d.each(e.data,i,p),c.appendChild(p.fragment),e.form=c,e.iframe=c.firstChild,e.impostors=p.impostors,e.fileUpload=p.files,o.string(f)||(e.responseType=r.defaultType),o.clear(p),e.transportPromise=r.createTransportPromise(e),c=null},onTransport:function(e){var t=e.form,r="application/x-www-form-urlencoded";e.fileUpload&&(r="multipart/form-data"),e.addHeaders("Content-type: "+r),"ready"===t.getAttribute("data-readystate")?this.onFormReady():c.on(t,"libdom-http-ready",this.onFormReady)},onSuccess:function(e){var t=this,r=t.response,n=e.formResponse;l.string(n)&&(r.body=n)},onCleanup:function(e){var t=e.impostors,r=e.form;l.array(t)&&a(t),r&&c.remove(r.parentNode||r),e.transportPromise=e.resolve=e.reject=e.form=r=null}}),e.exports=u}).call(t,function(){return this}())}])});